#include<stdio.h>
#include "AISP_TSL_base.h"
#include "AISP_TSL_str.h"
#include "AISP_TSL_common.h"
#include "AISP_TSL_complex.h"
#include "AISP_TSL_sqrt.h"
#include "fft_wrapper.h"
#include "sevc_config.h"
#include "sevc_types.h"
#include "sevc_util.h"

#include "sevc_types.h"

extern FILE *fpYyPcm;

#if SEVC_SWITCH_AES

aisp_s32_t innerGainNormalRef[257] =
{
    1481153, 1481153, 1481153, 1481153, 1289608, 933880, 742335, 916244,
    1254334, 1481153, 1554101, 1615239, 1666103, 1708233, 1743166, 1772439,
    1797590, 1820157, 1841677, 1863689, 1887729, 1915336, 1948048, 1987401,
    2034934, 2092184, 2186002, 2327195, 2493234, 2661590, 2809737, 2915146,
    2955289, 2953264, 2947341, 2937749, 2924718, 2908475, 2889249, 2867271,
    2842767, 2815967, 2787101, 2756396, 2724081, 2690386, 2655540, 2619770,
    2583305, 2546376, 2509210, 2472036, 2435083, 2398580, 2362756, 2327840,
    2294059, 2261644, 2230823, 2201825, 2174878, 2150212, 2128055, 2108636,
    2092184, 2077311, 2062479, 2047696, 2032966, 2018297, 2003695, 1989165,
    1974714, 1960348, 1946073, 1931895, 1917821, 1903856, 1890007, 1876279,
    1862680, 1849215, 1835891, 1822713, 1809687, 1796821, 1784119, 1771588,
    1759235, 1747065, 1735085, 1723301, 1711718, 1700344, 1689184, 1678244,
    1667531, 1657050, 1646808, 1636811, 1627066, 1617578, 1608353, 1599398,
    1590718, 1582321, 1574211, 1566396, 1558881, 1551673, 1544778, 1538201,
    1531950, 1526030, 1520447, 1515207, 1510317, 1505783, 1501611, 1497807,
    1494377, 1491328, 1488666, 1486396, 1484525, 1483059, 1482004, 1481367,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153
};

aisp_s32_t micGain1[257] =
{
    66161, 76407, 86821, 97494, 108521, 119994, 132008, 145095,
    159621, 175427, 192353, 210239, 228927, 248257, 268069, 288205,
    308505, 328809, 348958, 368793, 388154, 406883, 424819, 441803,
    457676, 472278, 485451, 497034, 506869, 514795, 520654, 524287,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 526155, 527968, 530892, 534849, 539758, 545541, 552117,
    559408, 567335, 575817, 584775, 594130, 603803, 613715, 623785,
    633934, 644083, 654153, 664064, 673737, 683093, 692051, 700533,
    708460, 715751, 722327, 728110, 733019, 736976, 739900, 741713,
    742335, 742335, 742335, 742335, 742335, 742335, 742335, 742335,
    742335, 742335, 742335, 742335, 742335, 742335, 742335, 742335,
    742335, 742335, 742335, 742335, 742335, 742335, 742335, 742335,
    742335, 742335, 742335, 742335, 742335, 742335, 742335, 742335,
    742335, 742335, 742335, 742335, 742335, 742335, 742335, 742335,
    742335, 742335, 742335, 742335, 742335, 742335, 742335, 742335,
    742335, 742335, 742335, 742335, 742335, 742335, 742335, 742335,
    742335, 742335, 742335, 742335, 742335, 742335, 742335, 742335,
    742335, 742160, 741641, 740781, 739587, 738064, 736218, 734054,
    731577, 728794, 725709, 722328, 718657, 714700, 710464, 705954,
    701176, 696134, 690835, 685283, 679485, 673446, 667171, 660666,
    653936, 646987, 639824, 632453, 624879, 617108, 609145, 600995,
    592665, 584159, 575483, 566643, 557644, 548492, 539191, 529748,
    520168, 510457, 500619, 490661, 480588, 470405, 460118, 449732,
    439253, 428686, 418037, 407312, 396515, 385652, 374730, 363752,
    352725, 341654, 330545, 319403, 308233, 297042, 285834, 274615,
    263390
};

aisp_s32_t micGain2[257] =
{
    16619, 26935, 37209, 47280, 56984, 66161, 75204, 84578,
    94229, 104099, 114132, 124273, 134466, 144654, 154781, 164792,
    174631, 184240, 193566, 202550, 211137, 219272, 226898, 233959,
    240400, 246163, 251193, 255435, 258831, 261327, 262865, 263390,
    263390, 263390, 263390, 263390, 263390, 263390, 263390, 263390,
    263390, 263390, 263390, 263390, 263390, 263390, 263390, 263390,
    263390, 263390, 263390, 263390, 263390, 263390, 263390, 263390,
    263390, 263390, 263390, 263390, 263390, 263390, 263586, 264166,
    265117, 266426, 268082, 270071, 272380, 274998, 277911, 281108,
    284575, 288300, 292270, 296473, 300896, 305527, 310352, 315360,
    320538, 325873, 331353, 336965, 342697, 348535, 354468, 360482,
    366566, 372706, 378891, 385106, 391341, 397582, 403817, 410033,
    416217, 422357, 428441, 434456, 440388, 446227, 451958, 457570,
    463050, 468385, 473563, 478571, 483397, 488027, 492450, 496653,
    500624, 504348, 507815, 511012, 513925, 516543, 518853, 520841,
    522497, 523806, 524757, 525337, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525533, 525533, 525533, 525533, 525533, 525533, 525533,
    525533, 525436, 525149, 524674, 524014, 523173, 522153, 520958,
    519591, 518054, 516351, 514485, 512460, 510277, 507941, 505453,
    502819, 500040, 497119, 494060, 490866, 487540, 484085, 480504,
    476800, 472976, 469036, 464982, 460818, 456546, 452170, 447692,
    443117, 438446, 433684, 428833, 423896, 418876, 413777, 408601,
    403352, 398032, 392646, 387195, 381683, 376113, 370489, 364812,
    359087, 353317, 347504, 341651, 335762, 329840, 323888, 317909,
    311906, 305882, 299840, 293784, 287716, 281640, 275558, 269474,
    263390,
};

aisp_s32_t innerMicGainLoose[257] =
{
    2092184, 2092184, 2092184, 2092184, 2092184, 2092184, 2092184, 2092184,
    2092184, 2092184, 2092184, 2092184, 2092184, 2092184, 2092184, 2092184,
    2092184, 2092184, 2092184, 2092184, 2092184, 2092184, 2092184, 2092184,
    2092184, 2092184, 2092184, 2092184, 2092184, 2092184, 2092184, 2092184,
    2092184, 2093971, 2099210, 2107717, 2119311, 2133809, 2151028, 2170785,
    2192898, 2217184, 2243460, 2271543, 2301251, 2332402, 2364812, 2398299,
    2432679, 2467772, 2503393, 2539359, 2575490, 2611600, 2647509, 2683033,
    2717989, 2752196, 2785469, 2817627, 2848487, 2877865, 2905580, 2931449,
    2955289, 2978231, 3001514, 3025114, 3049011, 3073181, 3097602, 3122251,
    3147106, 3172144, 3197344, 3222681, 3248135, 3273683, 3299301, 3324969,
    3350662, 3376359, 3402037, 3427675, 3453248, 3478735, 3504114, 3529362,
    3554456, 3579374, 3604094, 3628592, 3652848, 3676837, 3700539, 3723929,
    3746987, 3769688, 3792012, 3813934, 3835434, 3856488, 3877074, 3897170,
    3916753, 3935800, 3954290, 3972199, 3989505, 4006187, 4022220, 4037583,
    4052254, 4066210, 4079428, 4091886, 4103561, 4114432, 4124475, 4133668,
    4141989, 4149415, 4155924, 4161493, 4166100, 4169722, 4172337, 4173923,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456
};

aisp_s32_t innerMicGainNormal[257] =
{
    1481153, 1481153, 1481153, 1481153, 1289608, 933880, 742335, 887451,
    1196748, 1481153, 1683027, 1871989, 2049845, 2218406, 2379480, 2534876,
    2686402, 2835867, 2985081, 3135851, 3289987, 3449297, 3615590, 3790676,
    3976361, 4174456, 4404361, 4671518, 4956798, 5241073, 5505213, 5730091,
    5896576, 6026413, 6154016, 6279260, 6402022, 6522178, 6639604, 6754177,
    6865773, 6974268, 7079538, 7181459, 7279909, 7374762, 7465896, 7553186,
    7636509, 7715740, 7790757, 7861436, 7927652, 7989282, 8046202, 8098288,
    8145418, 8187466, 8224309, 8255824, 8281886, 8302372, 8317158, 8326120,
    8329135, 8326124, 8317217, 8302604, 8282476, 8257023, 8226435, 8190902,
    8150614, 8105762, 8056535, 8003125, 7945720, 7884512, 7819690, 7751445,
    7679967, 7605445, 7528071, 7448035, 7365526, 7280734, 7193851, 7105066,
    7014569, 6922550, 6829201, 6734710, 6639268, 6543066, 6446293, 6349139,
    6251796, 6154452, 6057299, 5960526, 5864323, 5768882, 5674391, 5581041,
    5489023, 5398526, 5309741, 5222857, 5138066, 5055557, 4975520, 4898146,
    4823625, 4752147, 4683901, 4619080, 4557871, 4500467, 4447056, 4397830,
    4352978, 4312690, 4277157, 4246568, 4221115, 4200987, 4186375, 4177468,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456
};

aisp_s32_t innerMicGainNormalTest[257] =
{
    742335, 674946, 602520, 525533, 422411, 313774, 263390, 369353,
    581748, 742335, 818959, 885779, 944027, 994933, 1039729, 1079644,
    1115910, 1149757, 1182416, 1215118, 1249094, 1285574, 1325789, 1370970,
    1422348, 1481153, 1547582, 1620996, 1701378, 1788707, 1882964, 1984129,
    2092184, 2214710, 2358212, 2521061, 2701626, 2898276, 3109380, 3333307,
    3568427, 3813109, 4065722, 4324635, 4588219, 4854841, 5122871, 5390678,
    5656632, 5919102, 6176457, 6427067, 6669299, 6901525, 7122113, 7329432,
    7521851, 7697741, 7855469, 7993405, 8109919, 8203380, 8272157, 8314619,
    8329135, 8324907, 8312462, 8292158, 8264354, 8229409, 8187681, 8139528,
    8085310, 8025384, 7960110, 7889846, 7814950, 7735781, 7652697, 7566058,
    7476221, 7383545, 7288390, 7191112, 7092072, 6991627, 6890136, 6787957,
    6685449, 6582972, 6480882, 6379539, 6279302, 6180528, 6083577, 5988807,
    5896576, 5805528, 5713840, 5621177, 5527200, 5431574, 5333962, 5234026,
    5131430, 5025836, 4916908, 4804309, 4687702, 4566750, 4441116, 4310464,
    4174456, 4017361, 3827607, 3611099, 3373742, 3121441, 2860100, 2595625,
    2333920, 2080890, 1842439, 1624473, 1432896, 1273613, 1152529, 1075548,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576, 1048576,
    1048576
};

aisp_s32_t innerMicGainTight[257] =
{
    66161, 175733, 241476, 263390, 212257, 117294, 66161, 76830,
    102133, 132008, 164120, 202433, 246338, 295226, 348486, 405509,
    465685, 528405, 593059, 659038, 725731, 792528, 858822, 924000,
    987455, 1048576, 1109765, 1173067, 1237336, 1301425, 1364188, 1424479,
    1481153, 1535657, 1590167, 1644628, 1698985, 1753184, 1807168, 1860883,
    1914274, 1967286, 2019863, 2071952, 2123496, 2174440, 2224730, 2274311,
    2323127, 2371124, 2418246, 2464438, 2509645, 2553813, 2596886, 2638809,
    2679527, 2718985, 2757128, 2793901, 2829249, 2863117, 2895450, 2926192,
    2955289, 2983552, 3011821, 3040081, 3068318, 3096517, 3124663, 3152743,
    3180742, 3208646, 3236439, 3264109, 3291639, 3319017, 3346227, 3373255,
    3400087, 3426708, 3453103, 3479259, 3505161, 3530795, 3556145, 3581198,
    3605940, 3630355, 3654430, 3678150, 3701500, 3724467, 3747035, 3769191,
    3790920, 3812207, 3833038, 3853399, 3873275, 3892652, 3911515, 3929851,
    3947643, 3964880, 3981544, 3997623, 4013102, 4027967, 4042202, 4055795,
    4068729, 4080991, 4092567, 4103441, 4113600, 4123030, 4131715, 4139641,
    4146794, 4153160, 4158723, 4163470, 4167387, 4170458, 4172670, 4174007,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456, 4174456,
    4174456
};

aisp_s32_t eqGain[257] =
{
    33159, 82085, 130823, 178122, 222728, 263390, 301442, 339040,
    376160, 412783, 448886, 484447, 519445, 553858, 587665, 620844,
    653372, 685229, 716393, 746842, 776554, 805508, 833682, 861055,
    887604, 913308, 938146, 962095, 985135, 1007242, 1028397, 1048576,
    1068380, 1088382, 1108522, 1128737, 1148968, 1169153, 1189231, 1209141,
    1228822, 1248213, 1267253, 1285881, 1304035, 1321656, 1338682, 1355051,
    1370704, 1385578, 1399612, 1412747, 1424920, 1436071, 1446139, 1455062,
    1462780, 1469232, 1474356, 1478091, 1480377, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1481097, 1480929, 1480651,
    1480262, 1479763, 1479156, 1478440, 1477616, 1476684, 1475647, 1474503,
    1473254, 1471900, 1470442, 1468880, 1467216, 1465450, 1463581, 1461612,
    1459543, 1457373, 1455105, 1452738, 1450273, 1447711, 1445052, 1442298,
    1439448, 1436503, 1433464, 1430331, 1427106, 1423788, 1420379, 1416878,
    1413287, 1409607, 1405837, 1401979, 1398033, 1393999, 1389879, 1385673,
    1381381, 1377004, 1372544, 1368000, 1363372, 1358663, 1353872, 1349000,
    1344047, 1339015, 1333903, 1328713, 1323444, 1318099, 1312677, 1307178,
    1301604, 1295956, 1290233, 1284436, 1278567, 1272625, 1266612, 1260527,
    1254372, 1248147, 1241853, 1235490, 1229059, 1222561, 1215996, 1209365,
    1202668, 1195907, 1189081, 1182192, 1175240, 1168225, 1161148, 1154011,
    1146813, 1139554, 1132237, 1124861, 1117427, 1109936, 1102388, 1094783,
    1087123, 1079409, 1071639, 1063817, 1055941, 1048013, 1040033, 1032001,
    1023920, 1015788, 1007607, 999377, 991099, 982774, 974402, 965984,
    957520, 949011, 940458, 931861, 923221, 914539, 905815, 897050,
    888244, 879398, 870512, 861588, 852626, 843626, 834590, 825517,
    816409, 807266, 798088, 788876, 779632, 770355, 761046, 751706,
    742335
};

aisp_s32_t eqGain2[257] =
{
    1048576, 1048576, 1048576, 1048576, 1160726, 1369003, 1481153, 1481153,
    1481153, 1481153, 1481153, 1481153, 1481153, 1491164, 1516982, 1552285,
    1590749, 1626052, 1651870, 1661881, 1661881, 1661881, 1661881, 1661881,
    1661881, 1661881, 1680709, 1730494, 1801192, 1882755, 1965139, 2038297,
    2092184, 2131859, 2169179, 2204300, 2237373, 2268554, 2297994, 2325847,
    2352268, 2377408, 2401423, 2424464, 2446686, 2468242, 2489285, 2509969,
    2530447, 2550873, 2571399, 2592180, 2613369, 2635119, 2657584, 2680917,
    2705271, 2730800, 2757658, 2785997, 2815971, 2847734, 2881439, 2917240,
    2955289, 2997749, 3046396, 3100800, 3160533, 3225165, 3294268, 3367413,
    3444171, 3524113, 3606811, 3691835, 3778757, 3867148, 3956579, 4046622,
    4136846, 4226825, 4316128, 4404327, 4490994, 4575698, 4658012, 4737507,
    4813753, 4886323, 4954786, 5018715, 5077680, 5131253, 5179005, 5220506,
    5255329, 5286581, 5317621, 5348399, 5378862, 5408961, 5438644, 5467859,
    5496555, 5524682, 5552188, 5579021, 5605131, 5630467, 5654977, 5678609,
    5701314, 5723039, 5743734, 5763346, 5781826, 5799122, 5815182, 5829956,
    5843392, 5855439, 5866046, 5875161, 5882734, 5888713, 5893047, 5895685,
    5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576,
    5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576,
    5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576,
    5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576,
    5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576,
    5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576,
    5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576,
    5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576, 5896576,
    5896576, 5895505, 5892313, 5887033, 5879701, 5870349, 5859011, 5845721,
    5830512, 5813418, 5794473, 5773710, 5751163, 5726866, 5700852, 5673156,
    5643809, 5612847, 5580303, 5546211, 5510604, 5473516, 5434980, 5395031,
    5353702, 5311026, 5267038, 5221770, 5175257, 5127532, 5078629, 5028582,
    4977424, 4925189, 4871910, 4817621, 4762357, 4706149, 4649033, 4591042,
    4532209, 4472569, 4412154, 4350999, 4289137, 4226601, 4163426, 4099646,
    4035293, 3970401, 3905005, 3839137, 3772832, 3706122, 3639043, 3571627,
    3503908, 3435919, 3367695, 3299270, 3230675, 3161947, 3093117, 3024220,
    2955289
};

#endif

//default Q15
#if SEVC_SWITCH_AES

U32 SEVC_AES_ShMemSizeGet(SEVC_CONFIG_S *pstSevcCfg)
{
    U32 uiTotalMemSize = 0;
    return uiTotalMemSize;
}

U32 SEVC_AES_LocMemSizeGet(SEVC_CONFIG_S *pstSevcCfg)
{
    U32 uiTotalMemSize = 0;
    U32 uiSize;
    U16 usFftBin = pstSevcCfg->usFftBin;
    uiSize = sizeof(SEVC_AES_S);
    uiTotalMemSize += SIZE_ALIGN(uiSize);
    // cross spectrum of error and mic
    uiTotalMemSize += usFftBin * sizeof(aisp_cpx_s32_t);
    // power spectrum of estimated echo
    uiTotalMemSize += usFftBin * sizeof(aisp_s64_t);
    // alpha
    uiTotalMemSize += usFftBin * sizeof(aisp_s32_t);
#if MEM_BUFF_DBG
    MSG_DBG("%s [%d] uiTotalMemSize=%d\r\n", __func__, __LINE__, uiTotalMemSize);
#endif
    return uiTotalMemSize;
}

SEVC_AES_S *SEVC_AES_New(SEVC_CONFIG_S *pstSevcCfg, MEM_LOCATOR_S *pstMemLocator)
{
    SEVC_AES_S *pstAesEng = NULL;
    U16 usSize;
    U16 idx;
    U16 usFftBin = pstSevcCfg->usFftBin;
    MEM_LOCATOR_SHOW(pstMemLocator);
    usSize = sizeof(SEVC_AES_S);
    pstAesEng = (SEVC_AES_S *)memLocatorGet(pstMemLocator, usSize, AISP_ALIGN_ON);
    AISP_TSL_PTR_CHECK(pstAesEng, FAIL);
    pstAesEng->pstSevcCfg = pstSevcCfg;
    // allocate for pEd
    BUFF_POINT_SET_ALIGN(pstAesEng->pEd, usFftBin * sizeof(aisp_cpx_s32_t), pstMemLocator, FAIL);
    // allocate for pYy
    BUFF_POINT_SET_ALIGN(pstAesEng->pYy, usFftBin * sizeof(aisp_s64_t), pstMemLocator, FAIL);
    // allocate for pAlpha
    BUFF_POINT_SET_ALIGN(pstAesEng->pAlpha, usFftBin * sizeof(aisp_s32_t), pstMemLocator, FAIL);

    for (idx = 0; idx < usFftBin; ++idx)
    {
        pstAesEng->pAlpha[idx] = AISP_TSL_Q16_ONE;
    }

    return pstAesEng;
FAIL:
    return NULL;
}

VOID SEVC_AES_CallBackFuncRegister(SEVC_AES_S *pstAesEng, VOID *pCBFunc, VOID *pUsrData)
{
    if (NULL == pstAesEng || NULL == pCBFunc)
    {
        MSG_DBG("%s [%d] params error\r\n", __func__, __LINE__);
        return ;
    }

    pstAesEng->pCallBackFunc = (CallBackFunc)pCBFunc;
    pstAesEng->pUsrData = pUsrData;
}

VOID SEVC_AES_Feed(SEVC_AES_S *pstAesEng, aisp_cpx_s32_t *pMic, aisp_cpx_s32_t *pErr,
                   aisp_cpx_s32_t *pEcho, aisp_s32_t refVad)
{
    S32 idx;
    SEVC_CONFIG_S *pstSevcCfg = pstAesEng->pstSevcCfg;
    U16 usFftBin = pstSevcCfg->usFftBin;
    U16 usSizeComp = sizeof(aisp_cpx_s32_t);
    aisp_cpx_s32_t *pEd     =      pstAesEng->pEd;
    aisp_s64_t *pYy         =      pstAesEng->pYy;
    aisp_cpx_s32_t *pDf     =      pMic;
    aisp_cpx_s32_t *pEf     =      pErr;
    aisp_cpx_s32_t *pYf     =      pEcho;
    aisp_s32_t gamma        =      pstSevcCfg->fGamma;
    aisp_s32_t minusGamma   =      AISP_TSL_Q20_ONE - gamma;
    aisp_s32_t *pAlpha      =      pstAesEng->pAlpha;
    aisp_s32_t alphaMin     =      pstSevcCfg->alphaMin;
    aisp_s32_t alphaMax     =      pstSevcCfg->alphaMax;
    aisp_s32_t alphaDiff    =      alphaMax - alphaMin;
    aisp_s32_t fGainFloor   =      pstSevcCfg->fAesGainFloor;
    aisp_s64_t tmp2Real;
    aisp_s64_t tmp2Imag;
    aisp_s64_t tmp64;
    aisp_s32_t fGain;

    for (idx = 0; idx < usFftBin; ++idx)
    {
        // COMPLEX_CONJ_MUL_SQ(tmpCpx, *pEf, *pDf, 26);
        tmp2Real = (aisp_s64_t)pEf->real * pDf->real + (aisp_s64_t)pEf->imag * pDf->imag;
        tmp2Real = PSHR(tmp2Real, 26);
        tmp2Imag = (aisp_s64_t)pEf->imag * pDf->real - (aisp_s64_t)pEf->real * pDf->imag;
        tmp2Imag = PSHR(tmp2Imag, 26);
        tmp2Real = (aisp_s64_t)gamma * pEd->real + (aisp_s64_t)minusGamma * tmp2Real;
        tmp2Imag = (aisp_s64_t)gamma * pEd->imag + (aisp_s64_t)minusGamma * tmp2Imag;
        pEd->real = PSHR(tmp2Real, 20);
        pEd->imag = PSHR(tmp2Imag, 20);
        pEf++;
        pDf++;
        pEd++;
    }

    for (idx = 0; idx < usFftBin; ++idx)
    {
        tmp64 = (aisp_s64_t)pYf->real * pYf->real + (aisp_s64_t)pYf->imag * pYf->imag;
        *pYy = (aisp_s64_t)gamma * (*pYy) + (aisp_s64_t)minusGamma * PSHR(tmp64, 26);
        *pYy = PSHR(*pYy, 20);
        pYf++;
        pYy++;
    }

    pEd = pstAesEng->pEd;
    pYy = pstAesEng->pYy;
    pYf = pEcho;
    pEf = pErr;

    if (refVad == 1)
    {
        for (idx = 0; idx < usFftBin; ++idx)
        {
            tmp64 = AISP_TSL_sqrt_xW64_yW32((aisp_s64_t)pYf->real * pYf->real + (aisp_s64_t)pYf->imag * pYf->imag);
            tmp64 = alphaMin + PDIV(alphaDiff * tmp64, AISP_TSL_Q22_ONE);
            *pAlpha = AISP_TSL_MIN(alphaMax, AISP_TSL_MAX(tmp64, alphaMin));
            pYf++;
            pAlpha++;
        }
    }
    else
    {
        for (idx = 0; idx < usFftBin; ++idx)
        {
            *pAlpha = alphaMin;
            pAlpha++;
        }
    }

    pAlpha = pstAesEng->pAlpha;

    for (idx = 0; idx < usFftBin; ++idx)
    {
        //fGain = PDIV((aisp_s64_t)AISP_TSL_Q20_ONE * alpha * (*pYy), (aisp_s64_t)AISP_TSL_ABS(pEd->real) + alpha * (*pYy) + 1);
        //fGain = (aisp_s32_t)AISP_TSL_Q20_ONE - fGain;
        fGain = PDIV((aisp_s64_t)AISP_TSL_Q20_ONE * AISP_TSL_ABS(pEd->real),
                     (aisp_s64_t)AISP_TSL_ABS(pEd->real) + PSHR((*pAlpha) * (*pYy), 16) + 1);
        fGain = refVad == 1 ? SHL(fGain, 1) : fGain;
        fGain = AISP_TSL_MAX(fGain, fGainFloor);
        pEf->real = PSHR((aisp_s64_t)fGain * pEf->real, 20);
        pEf->imag = PSHR((aisp_s64_t)fGain * pEf->imag, 20);
        pEd++;
        pYy++;
        pEf++;
        pAlpha++;
    }

    if (NULL != pstAesEng->pCallBackFunc)
    {
        pstAesEng->pCallBackFunc((U8 *)pErr,
                                 usFftBin * usSizeComp, pstAesEng->pUsrData);
    }
}


VOID SEVC_AES_Reset(SEVC_AES_S *pstAesEng)
{
}

VOID SEVC_AES_Delete(SEVC_AES_S *pstAesEng)
{
}

#endif

